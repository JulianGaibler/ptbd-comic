---
import { getImage } from 'astro:assets'

type Props = {
  src: ImageMetadata
  alt?: string
  className?: string
}

const { src, alt, className } = Astro.props

const skipOptimization = import.meta.env.PUBLIC_SKIP_IMAGE_OPTIMIZATION === 'true'
const optimizedAvif = skipOptimization ? null : await getImage({ src, format: 'avif', quality: 90 })
---

<picture class={className}>
  {optimizedAvif && <source srcset={optimizedAvif.src} type="image/avif" />}
  <img src={src.src} alt={alt} />
</picture>

<style lang="sass">
  picture
    display: block
    overflow: hidden
  img
    display: block
    width: 100%
</style>
